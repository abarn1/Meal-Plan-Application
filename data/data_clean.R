library(stringr)
library(reshape2)
library(readr)
nutrition <- read_csv("D:/OneDrive/Documents/DA401/data/BFPD_csv_07132018/Nutrients.csv")
products <- read_csv("D:/OneDrive/Documents/DA401/data/BFPD_csv_07132018/Products.csv")
nutrition <- subset(nutrition, select = -c(Nutrient_Code, Derivation_Code, Output_uom))
nutrition2 <- dcast(nutrition, NDB_No ~ Nutrient_name, mean)
nutrition2 <- subset(nutrition2, select = c(NDB_No, Protein, `Calcium, Ca`, `Carbohydrate, by difference`, `Fiber, total dietary`, `Fatty acids, total saturated`, `Iron, Fe`, `Sodium, Na`, `Sugars, total`, `Total lipid (fat)`, `Vitamin A, IU`, `Vitamin B-12`, `Vitamin C, total ascorbic acid`, `Vitamin D`, `Vitamin E`, `Zinc, Zn`, Energy))
names(nutrition2) <- c("NDB_Number", "Protein", "Calcium", "Carbohydrate", "Fiber", "Saturated Fat", "Iron", "Sodium", "Sugar", "Fat", "Vitamin A", "Vitamin B-12", "Vitamin C", "Vitamin D", "Vitamin E", "Zinc", "Energy")
products2 <- subset(products, select = -c(data_source, gtin_upc, date_modified, date_available))
merge_nutrition <- merge(nutrition2, products2, by='NDB_Number')
wal_nut <- subset(merge_nutrition, manufacturer == "Wal-Mart Stores, Inc.")

fin_nutrition = wal_nut

sum(is.na(fin_nutrition$Protein))
sum(is.na(fin_nutrition$Calcium))
sum(is.na(fin_nutrition$Carbohydrate))
sum(is.na(fin_nutrition$Fiber))
sum(is.na(fin_nutrition$`Saturated Fat`))
sum(is.na(fin_nutrition$Iron))
sum(is.na(fin_nutrition$Sodium))
sum(is.na(fin_nutrition$Sugar))
sum(is.na(fin_nutrition$Fat))
sum(is.na(fin_nutrition$`Vitamin A`))
sum(is.na(fin_nutrition$`Vitamin B-12`))
sum(is.na(fin_nutrition$`Vitamin C`))
sum(is.na(fin_nutrition$`Vitamin D`))
sum(is.na(fin_nutrition$`Vitamin E`))
sum(is.na(fin_nutrition$Zinc))
sum(is.na(fin_nutrition$Energy))

write_csv(fin_nutrition, "D:/OneDrive/Documents/DA401/data/nutrition_data.csv")
